<!DOCTYPE html>
<html>

<head>
    <meta http-equiv="Content-Type" content="text/html; charset=utf-8">
<meta content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no" name="viewport" />
<meta content="telephone=no" name="format-detection"/>
<meta content="email=no" name="format-detection"/>

    <!-- css for this page only -->    <title>element library</title>

    <link rel="stylesheet" type="text/css" href="/public/static/css/base_63a6f74.css" />
    <link rel="stylesheet" type="text/css" href="/public/static/css/index_b22c8a6.css" />
    <link rel="stylesheet" type="text/css" href="/public/static/css/elementLibrary_4aeaea1.css" />
    <link rel="stylesheet" type="text/css" href="/public/static/css/metroStyle_5ca98f4.css" />
    <style type="text/css">
    .active-item {
        color: #ff6c60;
    }
    ul.sidebar-menu li ul.sub li a {
        color: #a3acb6;
    }


    .vac-confirm .modal-dialog {
        margin-top: 80px;
    }
    .vac-confirm .modal-content {
        width: 500px;
        margin: auto;
        border: 1px solid #ddd;
        /*box-shadow: 5px 5px 2px #d9edf7;*/
    }
    .vac-confirm .modal-header {
        padding: 10px 15px;
        background-color: #55A8A1;
    }
    .vac-confirm .modal-body {
        padding: 15px 15px;
        color: #a94442;
    }
    .vac-confirm .modal-footer {
        padding: 10px 20px;
    }


	.vac-alert .modal-dialog {
		margin-top: 80px;
		z-index: 100;
	}
	.vac-alert .modal-content {
		width: 500px;
		margin: auto;
		border: 1px solid #ddd;
	}
	.vac-alert .modal-header {
		padding: 10px 15px;
		background-color: #55A8A1;
	}
	.vac-alert .modal-body {
		padding: 15px 15px;
		color: #a94442;
	}
	.vac-alert .modal-footer {
		padding: 10px 20px;
	}


	.copy-right {
		height: 50px;
	}
</style>
</head>

<body id="elementLibrary" v-cloak>
    <div class="content">
        <!--header start-->
        <header class="header white-bg">
    <div class="sidebar-toggle-box">
        <div data-original-title="点击折叠" data-placement="right" class="icon-reorder tooltips"></div>
    </div>
    <!--logo start-->
    <a href="#" class="logo"><span>ATF</span></a>
    <!--logo end-->

    <div class="top-nav ">
        <!--user info start-->
        <ul class="nav pull-right top-menu">
            <!-- user login dropdown start-->
            <li class="dropdown">
                <a data-toggle="dropdown" class="dropdown-toggle" href="#">
                    <img alt="" src="/public/static/images/avatar1_small_64c14fd.jpg">
                    <span class="username" id="curUserName">chai</span>
                    <b class="caret"></b>
                </a>
                <ul class="dropdown-menu extended logout">
                    <div class="log-arrow-up"></div>
                    <li><a href="#"><i class="icon-suitcase"></i>个人中心</a></li>
                    <li><a href="#"><i class="icon-cog"></i>设置</a></li>
                    <li><a href="#"><i class="icon-bell-alt"></i> 通知</a></li>
                    <li><a id="logout"><i class="icon-key"></i> 注销</a></li>
                </ul>
            </li>
            <!-- user login dropdown end -->
        </ul>
        <!--search & user info end-->
    </div></header>
        <!--header end-->
        <!--sidebar start-->
        <aside>
    <div id="sidebar" class="nav-collapse">
        <ul class="sidebar-menu">
            <li class="sub-menu 0">
                <a href="javascript:;" class="">
                    <span class="">系统管理</span>
                    <span class="arrow"></span>
                </a>
                <ul class="sub 0-ul">
                    <li class="sub-menu">
                        <a class="0-0" href="usermanagement.html">
                            <span>用户管理</span>
                        </a>
                    </li>
                    <!-- <li class="sub-menu">
                        <a class="0-1" href="#">
                            <span>权限设置</span>
                        </a>
                    </li>
                    <li class="sub-menu">
                        <a class="0-2" href="#">
                            <span>数据字典设置</span>
                        </a>
                    </li> -->
                </ul>
            </li>
            <li class="sub-menu 1">
                <a href="javascript:;" class="">
                    <!-- <i class="icon-th"></i> -->
                    <span>测试过程配置</span>
                    <span class="arrow"></span>
                </a>
                <ul class="sub 1-ul">
                    <li class="sub-menu">
                        <a class="1-0" href="testphase.html">
                            <span>测试阶段</span>
                        </a>
                    </li>
                    <li class="sub-menu">
                        <a class="1-1" href="productLine.html">
                            <span>业务线管理</span>
                        </a>
                    </li>
                    <li class="sub-menu">
                        <a class="1-2" href="runner-management.html">
                            <span>执行机管理</span>
                        </a>
                    </li>
                </ul>
            </li>
            <li class="sub-menu 2">
                <a href="javascript:;" class="">
                    <!-- <i class="icon-th"></i> -->
                    <span>测试基础设施</span>
                    <span class="arrow"></span>
                </a>
                <ul class="sub 2-ul">
                    <li class="sub-menu">
                        <a class="2-0" href="aut.html">
                            <span>被测系统管理</span>
                        </a>
                    </li>
                    <li class="sub-menu">
                        <a class="2-1" href="architecture.html">
                            <span>自动化构件管理</span>
                        </a>
                    </li>
                </ul>
            </li>
            <li class="sub-menu 3">
                <a href="javascript:;" class="">
                    <!-- <i class="icon-th"></i> -->
                    <span>项目测试</span>
                    <span class="arrow"></span>
                </a>
                <ul class="sub 3-ul">
                    <li class="sub-menu">
                        <a class="3-0" href="testitems.html">
                            <span>测试任务</span>
                        </a>
                    </li>
                    <li class="sub-menu">
                        <a class="3-1" href="testProject.html">
                            <span>测试项目管理</span>
                        </a>
                    </li>
                    <li class="sub-menu">
                        <a class="3-2" href="caseManagement.html">
                            <span>测试用例管理</span>
                        </a>
                    </li>
                    <li class="sub-menu">
                        <a class="3-3" href="datatable.html">
                            <span>测试资源管理</span>
                        </a>
                    </li>
                    <li class="sub-menu">
                        <a class="3-4" href="scene.html">
                            <span>测试场景管理</span>
                        </a>
                    </li>
                    <li class="sub-menu">
                        <a class="3-5" href="testroundManage.html">
                            <span>测试轮次管理</span>
                        </a>
                    </li>
                    <li class="sub-menu">
                        <a class="3-6" href="testplan-execute.html">
                            <span>测试计划及执行</span>
                        </a>
                    </li>
                    <li class="sub-menu">
                        <a class="3-7" href="testRecord.html">
                            <span>执行记录管理</span>
                        </a>
                    </li>
                    <li class="sub-menu">
                        <a class="3-8" href="execution.html">
                            <span>批量执行管理</span>
                        </a>
                    </li>
                    <li class="sub-menu">
                        <a class="3-9" href="../build/pages/testplan">
                            <span>测试计划</span>
                        </a>
                    </li>
                </ul>
            </li>
            <!-- <li class="sub-menu 4">
                <a href="javascript:;" class="">
                    <span>测试资产库</span>
                    <span class="arrow"></span>
                </a>
                <ul class="sub 4-ul">
                    
                </ul>
            </li> -->
        </ul>
        <!-- sidebar menu end-->
    </div>
</aside>        <!--sidebar end-->
        <!--main content start-->
        <section id="main-content">
            <section class="wrapper">
                <div>
                    <!-- breadcrumb start -->
                    <div class="row">
                        <div class="col-xs-12">
                            <ul class="breadcrumb">
                                <li><a href="aut.html"><i class="icon-home"></i> 被测系统管理</a></li>
                                <li><a href="transact.html">功能点</a></li>
                                <li class="active">元素库</li>
                            </ul>
                        </div>
                    </div>
                    <!-- breadcrumb end -->
                    <div class="row">
                        <div class="col-xs-12">
                            <section class="panel panel-pad">
                                <!-- select start -->
                                <form class="form-horizontal">
                                    <div class="form-group">
                                        <label class="col-xs-1 control-label">被测系统</label>
                                        <div class="col-xs-2">
                                            <select class="form-control" id="autSelect">
                                            </select>
                                        </div>
                                        <label class="col-xs-1 control-label">功能点</label>
                                        <div class="col-xs-2">
                                            <select class="form-control" id="transactSelect" v-model="transid">
                                            </select>
                                        </div>
                                        <a class="btn btn-white" @click="toObjectRepo"><i class="icon-external-link"></i> 对象库</a>
                                        <a class="btn btn-white" @click="toScript"><i class="icon-external-link"></i> 基础脚本</a>
                                    </div>
                                </form>
                                <!-- select end -->
                            </section>
                        </div>
                    </div>
                    <div class="row">
                        <div class="col-xs-4">
                            <section class="panel tree-panel">
                                <header class="panel-heading">
                                    元素库
                                </header>
                                <div id="menuContent" class="menuContent treeMenu">
                                    <div class="form-group panel-pad form-horizontal">
                                        <div class="col-xs-6">
                                            <input type="text" name="" id="keyword" value="" class="form-control empty input-sm">
                                        </div>
                                        <a class="btn btn-info btn-sm" id="search-btn" @click="searchNodes()">搜索</a>
                                    </div>
                                    <div class="form-group form-horizontal">
                                        <div class="col-xs-12">
                                            <a class="btn btn-info btn-sm" data-toggle="modal" href="#addUIModal">添加UI</a>
                                            <a class="btn btn-info btn-sm" @click="delUI">删除UI</a>
                                            <a class="btn btn-info btn-sm" data-toggle="modal" @click="checkAddElement">添加元素</a>
                                            <a class="btn btn-info btn-sm" @click="delElement">删除元素</a>
                                        </div>
                                    </div>
                                    <ul id="elementtree" class="ztree tree"></ul>
                                </div>
                            </section>
                        </div>
                        <div class="col-xs-8">
                            <section class="panel" id="blank">
                                <header class="panel-heading">
                                        名称
                                </header>
                                <div class="elementContent">
                                    <p class="chooseTip">请选择UI或元素</p>
                                </div>
                            </section>
                            <section class="panel" id="UI" style="display: none;">
                                <header class="panel-heading">
                                        {{UITitle}}
                                </header>
                                <div class="elementContent">
                                    <form class="form-horizontal panel-pad" id="UIForm">
                                        <div class="form-group">
                                            <label class="col-xs-2 control-label">UI名称：</label>
                                            <div class="col-xs-3">
                                                <input type="text" name="UIName" class="form-control" :value="UIName" id="RUIName">
                                            </div>
                                        </div>
                                        <div class="form-group">
                                            <label class="col-xs-3 control-label">关联对象库中对象：</label>
                                            <div class="col-xs-3">
                                                <input type="text" id="UILinkedInput" class="form-control" :value="UILinked" disabled>
                                            </div>
                                            <div class="col-xs-2">
                                                <a class="btn btn-info" data-toggle="modal" href="#UILinkedModal">关联对象</a>
                                            </div>
                                            <div class="col-xs-2">
                                                <a class="btn btn-info" @click="removeUILinked()">解除关联</a>
                                            </div>
                                            <div class="col-xs-2">
                                                <a class="btn btn-info" @click="updateUI">保存</a>
                                            </div>
                                        </div>
                                    </form>
                                </div>
                            </section>
                            <section class="panel" id="ele" style="display: none;">
                                <header class="panel-heading">
                                    {{eleName}}
                                </header>
                                <div class="elementContent">
                                    <form class="form-horizontal panel-pad" id="eleForm">
                                        <div class="form-group">
                                            <label class="col-xs-3 control-label">元素名称</label>
                                            <div class="col-xs-3">
                                                <input type="text" name="" class="form-control" :value="eleName" id="rEleName">
                                            </div>
                                            <label for="" class="col-xs-2 control-label">类型</label>
                                            <div class="col-xs-3">
                                                <select class="form-control" id="classtypeSelect">
                                                    <option value="">--选择控件类型--</option>
                                                    <option v-for="item in classtypeList" :value="item.name">{{item.name}}</option>
                                                </select>
                                            </div>
                                        </div>
                                        <div class="form-group">
                                            <label class="col-xs-3 control-label">对象库中父对象</label>
                                            <div class="col-xs-3">
                                                <input type="text" name="" id="eleParentInput" class="form-control" :value="eleParent" disabled>
                                            </div>
                                            <div class="col-xs-2">
                                                <a class="btn btn-info" data-toggle="modal" href="#eleParentModal">设置父对象</a>
                                            </div>
                                            <div class="col-xs-2">
                                                <a class="btn btn-info" @click="removeEleParent">解除关联</a>
                                            </div>
                                        </div>
                                        <div class="form-group">
                                            <label class="col-xs-3 control-label">对象库中关联对象</label>
                                            <div class="col-xs-3">
                                                <input type="text" name="" id="eleLinkedInput" class="form-control" :value="eleLinked" disabled>
                                            </div>
                                            <div class="col-xs-2">
                                                <a class="btn btn-info" data-toggle="modal" href="#eleLinkedModal">设置关联对象</a>
                                            </div>
                                            <div class="col-xs-2">
                                                <a class="btn btn-info" @click="removeEleLinked">解除关联</a>
                                            </div>
                                        </div>
                                    </form>
                                    <section class="panel small-panel">
                                        <header class="panel-heading">属性</header>
                                        <div class="property">
                                            主属性
                                            <a class="btn btn-white btn-sm pull-right" @click="addMainProp"><i class="icon-plus"></i></a>
                                            <a class="btn btn-white btn-sm pull-right" @click="delMainProp"><i class="icon-minus"></i></a>
                                        </div>
                                        <div class="property">
                                            <table class="table table-bordered">
                                                <thead>
                                                    <tr>
                                                        <th style="width:5%"></th>
                                                        <th>属性名</th>
                                                        <th>属性值</th>
                                                    </tr>
                                                </thead>
                                                <tbody id="mainTbody">
                                                    <tr class="text-center">
                                                        <td colspan="3">暂无数据</td>
                                                    </tr>
                                                </tbody>
                                            </table>
                                        </div>

                                        <div class="property">
                                            附加属性
                                            <a class="btn btn-white btn-sm pull-right" @click="addAddiProp"><i class="icon-plus"></i></a>
                                            <a class="btn btn-white btn-sm pull-right" @click="delAddiProp"><i class="icon-minus"></i></a>
                                        </div>
                                        <div class="property">
                                            <table class="table table-bordered">
                                                <thead>
                                                    <tr>
                                                        <th style="width:5%"></th>
                                                        <th>属性名</th>
                                                        <th>属性值</th>
                                                    </tr>
                                                </thead>
                                                <tbody id="addiTbody">
                                                    <tr class="text-center">
                                                        <td colspan="3">暂无数据</td>
                                                    </tr>
                                                </tbody>
                                            </table>
                                        </div>

                                        <div class="property">
                                            辅助属性
                                            <a class="btn btn-white btn-sm pull-right" @click="addAssiProp"><i class="icon-plus"></i></a>
                                            <a class="btn btn-white btn-sm pull-right" @click="delAssiProp"><i class="icon-minus"></i></a>
                                        </div>
                                        <div class="property">
                                            <table class="table table-bordered">
                                                <thead>
                                                    <tr>
                                                        <th style="width:5%"></th>
                                                        <th>属性名</th>
                                                        <th>属性值</th>
                                                    </tr>
                                                </thead>
                                                <tbody id="assiTbody">
                                                    <tr class="text-center">
                                                        <td colspan="3">暂无数据</td>
                                                    </tr>
                                                </tbody>
                                            </table>
                                        </div>

                                        <div class="property">
                                            关联属性
                                            <a class="btn btn-white btn-sm pull-right" @click="addLinkedProp"><i class="icon-plus"></i></a>
                                            <a class="btn btn-white btn-sm pull-right" @click="delLinkedProp"><i class="icon-minus"></i></a>
                                        </div>
                                        <div class="property">
                                            <table class="table table-bordered">
                                                <thead>
                                                    <tr>
                                                        <th style="width:5%"></th>
                                                        <th>属性名</th>
                                                        <th>属性值</th>
                                                    </tr>
                                                </thead>
                                                <tbody id="relatePropTbody">
                                                    <tr class="text-center">
                                                        <td colspan="3">暂无数据</td>
                                                    </tr>
                                                </tbody>
                                            </table>
                                        </div>
                                    </section>

                                    <a class="btn btn-info" @click="updateElement">保存</a>
                                </div>
                            </section>
                            <!-- addUIModal start -->
                            <div class="modal fade" id="addUIModal" tabindex="-1" role="dialog" aria-labelledby="insertModalLabel" aria-hidden="true">
                                <div class="modal-dialog">
                                    <div class="modal-content">
                                        <div class="modal-header">
                                            <button type="button" class="close" data-dismiss="modal" aria-hidden="true">&times;</button>
                                            <h4 class="modal-title">添加UI</h4>
                                        </div>
                                        <div class="modal-body">
                                            <!-- modal-body start -->
                                            <section class="panel">
                                                <form id="addUIForm" class="form-horizontal" role="form">
                                                    <div class="form-group">
                                                        <label class="col-xs-3 control-label">UI名称</label>
                                                        <div class="col-xs-5">
                                                            <input type="text" class="form-control" name="UIName" id="addUIName">
                                                        </div>
                                                    </div>
                                                    <div class="form-group">
                                                        <label class="col-xs-3 control-label"></label>
                                                        <div class="col-xs-5">
                                                            若要添加多个，请以英文逗号“,”隔开。
                                                        </div>
                                                    </div>
                                                    <div class="form-group hidden">
                                                        <label class="col-xs-3 control-label">relateIdentifyObjectId</label>
                                                        <div class="col-xs-5">
                                                            <input type="text" class="form-control" name="relateIdentifyObjectId" id="addRelateIdentifyObjectId">
                                                        </div>
                                                    </div>
                                                    <div class="form-group hidden">
                                                        <label class="col-xs-3 control-label"> relateParentIdentifyObjectId</label>
                                                        <div class="col-xs-5">
                                                            <input type="text" class="form-control" name="relateParentIdentifyObjectId" id="addRelateParentIdentifyObjectId">
                                                        </div>
                                                    </div>
                                                </form>
                                            </section>
                                            <!-- modal-body end -->
                                        </div>
                                        <div class="modal-footer">
                                            <button data-dismiss="modal" class="btn btn-default">取消</button>
                                            <button data-dismiss="modal" class="btn btn-success" @click="addUI">添加</button>
                                        </div>
                                    </div>
                                </div>
                            </div>
                            <!-- addUIModal end -->
                            <!-- addElementModal start -->
                            <div class="modal fade" id="addElementModal" tabindex="-1" role="dialog" aria-hidden="true">
                                <div class="modal-dialog">
                                    <div class="modal-content">
                                        <div class="modal-header">
                                            <button type="button" class="close" data-dismiss="modal" aria-hidden="true">&times;</button>
                                            <h4 class="modal-title">添加元素</h4>
                                        </div>
                                        <div class="modal-body">
                                            <!-- modal-body start -->
                                            <section class="panel">
                                                <form id="addElementForm" class="form-horizontal" role="form">
                                                    <div class="form-group">
                                                        <label class="col-xs-3 control-label">元素名称</label>
                                                        <div class="col-xs-5">
                                                            <input type="text" class="form-control" name="ElementName" id="addElementName">
                                                        </div>
                                                    </div>
                                                    <div class="form-group">
                                                        <label class="col-xs-3 control-label"></label>
                                                        <div class="col-xs-5">
                                                            若要添加多个，请以英文逗号“,”隔开。
                                                        </div>
                                                    </div>
                                                    <div class="form-group hidden">
                                                        <label class="col-xs-3 control-label">ClassType</label>
                                                        <div class="col-xs-5">
                                                            <input type="text" class="form-control" name="ClassType" id="addEleClassType">
                                                        </div>
                                                    </div>
                                                    <div class="form-group hidden">
                                                        <label class="col-xs-3 control-label"> relateIdentifyObjectId</label>
                                                        <div class="col-xs-5">
                                                            <input type="text" class="form-control" name=" relateIdentifyObjectId" id="addEleRelateIdentifyObjectId">
                                                        </div>
                                                    </div>
                                                    <div class="form-group hidden">
                                                        <label class="col-xs-3 control-label"> relateParentIdentifyObjectId</label>
                                                        <div class="col-xs-5">
                                                            <input type="text" class="form-control" name="  relateParentIdentifyObjectId" id="addEleRelateParentIdentifyObjectId">
                                                        </div>
                                                    </div>
                                                </form>
                                            </section>
                                            <!-- modal-body end -->
                                        </div>
                                        <div class="modal-footer">
                                            <button data-dismiss="modal" class="btn btn-default" type="button">取消</button>
                                            <button data-dismiss="modal" class="btn btn-success" type="button" @click="addElement">添加</button>
                                        </div>
                                    </div>
                                </div>
                            </div>
                            <!-- addElementModal end -->
                            <!-- successModal start -->
                            <div class="modal fade" id="successModalEle" tabindex="-1" style="" role="dialog" aria-labelledby="successModalLabel" aria-hidden="true">
                                <div class="modal-dialog">
                                    <div class="modal-content">
                                        <div class="modal-header">
                                            <button type="button" class="close" data-dismiss="modal" aria-hidden="true">&times;</button>
                                            <h4 class="modal-title">操作成功</h4>
                                        </div>
                                        <div class="modal-body">
                                            <h4>操作成功！</h4>
                                        </div>
                                        <div class="modal-footer">
                                            <button data-dismiss="modal" class="btn btn-success" type="button">确定</button>
                                        </div>
                                    </div>
                                </div>
                            </div>
                            <!-- successModal end -->
                            <!-- failModalEle start -->
                            <div class="modal fade" id="failModalEle" tabindex="-1" role="dialog" aria-labelledby="failModalEleLabel" aria-hidden="true">
                                <div class="modal-dialog">
                                    <div class="modal-content">
                                        <div class="modal-header">
                                            <button type="button" class="close" data-dismiss="modal" aria-hidden="true">&times;</button>
                                            <h4 class="modal-title">操作失败</h4>
                                        </div>
                                        <div class="modal-body">
                                            <h4>操作失败！</h4>
                                        </div>
                                        <div class="modal-footer">
                                            <button data-dismiss="modal" class="btn btn-success" type="button">确定</button>
                                        </div>
                                    </div>
                                </div>
                            </div>
                            <!-- failModalEle end -->
                            <!-- elementAlertModal start -->
                            <div class="modal fade" id="elementAlertModal" tabindex="-1" role="dialog" aria-hidden="true">
                                <div class="modal-dialog">
                                    <div class="modal-content">
                                        <div class="modal-header">
                                            <button type="button" class="close" data-dismiss="modal" aria-hidden="true">&times;</button>
                                            <h4 class="modal-title">操作失败</h4>
                                        </div>
                                        <div class="modal-body">
                                            <h4>请先选中UI！</h4>
                                        </div>
                                        <div class="modal-footer">
                                            <button data-dismiss="modal" class="btn btn-success" type="button">确定</button>
                                        </div>
                                    </div>
                                </div>
                            </div>
                            <!-- elementAlertModal end -->
                        </div>
                    </div>
                    <!-- <link rel="import" href="./common/copy-right.html?__inline"> -->
                    <div class="modal fade" id="UILinkedModal" tabindex="-1" role="dialog" aria-labelledby="objectModalLabel" aria-hidden="true">
                        <div class="modal-dialog">
                            <div class="modal-content">
                                <div class="modal-header">
                                    <button type="button" class="close" data-dismiss="modal" aria-hidden="true">&times;</button>
                                    <h4 class="modal-title">对象库</h4>
                                </div>
                                <div class="modal-body">
                                    <div id="menuContent" class="menuContent treeMenu">
                                        <ul id="UILinkedTree" class="ztree tree"></ul>
                                    </div>
                                </div>
                                <div class="modal-footer">
                                    <button data-dismiss="modal" class="btn btn-default">取消</button>
                                    <button data-dismiss="modal" class="btn btn-success" @click="setUILinked()">确认</button>
                                </div>
                            </div>
                        </div>
                    </div>
                    <!--UILinked objectmodal end -->
                    <!--eleParent objectmodal start -->
                    <div class="modal fade" id="eleParentModal" tabindex="-1" role="dialog" aria-labelledby="objectModalLabel" aria-hidden="true">
                        <div class="modal-dialog">
                            <div class="modal-content">
                                <div class="modal-header">
                                    <button type="button" class="close" data-dismiss="modal" aria-hidden="true">&times;</button>
                                    <h4 class="modal-title">对象库</h4>
                                </div>
                                <div class="modal-body">
                                    <div id="menuContent" class="menuContent treeMenu">
                                        <ul id="eleParentTree" class="ztree tree"></ul>
                                    </div>
                                </div>
                                <div class="modal-footer">
                                    <button data-dismiss="modal" class="btn btn-default">取消</button>
                                    <button data-dismiss="modal" class="btn btn-success" @click="setEleParent()">确认</button>
                                </div>
                            </div>
                        </div>
                    </div>
                    <!--eleParent objectmodal end -->
                    <!--eleLinked objectmodal start -->
                    <div class="modal fade" id="eleLinkedModal" tabindex="-1" role="dialog" aria-labelledby="objectModalLabel" aria-hidden="true">
                        <div class="modal-dialog">
                            <div class="modal-content">
                                <div class="modal-header">
                                    <button type="button" class="close" data-dismiss="modal" aria-hidden="true">&times;</button>
                                    <h4 class="modal-title">对象库</h4>
                                </div>
                                <div class="modal-body">
                                    <div id="menuContent" class="menuContent treeMenu">
                                        <ul id="eleLinkedTree" class="ztree tree"></ul>
                                    </div>
                                </div>
                                <div class="modal-footer">
                                    <button data-dismiss="modal" class="btn btn-default">取消</button>
                                    <button data-dismiss="modal" class="btn btn-success" @click="setEleLinked()">确认</button>
                                </div>
                            </div>
                        </div>
                    </div>
                    <!--eleLinked objectmodal end -->
                </div>
            </section>
        </section>
        <!--main content end-->
        <div class="footer">
            <div class="copy-right text-center">
    <span class="color-96">Copyright &copy; 1998－2018 BUPT All Rights Reserved <br>北京邮电大学物流工程实验室 版权所有</span> 
</div>
<div class="modal fade vac-confirm" tabindex="-1" role="dialog" id="vac-confirm" >    
    <div class="modal-dialog" role="document">
        <div class="modal-content">
            <div class="modal-header">
                <button type="button" class="close cancelConfirm" data-dismiss="modal" aria-label="Close"><span aria-hidden="true">&times;</span></button>
                <h4  class="modal-title">警告信息</h4>
            </div>
            <div class="modal-body">
                <p class="modal-message">确认要进行此操作吗？</p>
            </div>
            <div class="modal-footer">
                <button type="button" class="btn btn-primary cancelConfirm">取消</button>
                <button type="button" class="btn btn-info okConfirm">确定</button>
            </div>
        </div>
    </div>
</div>
<div class="modal fade vac-alert" tabindex="-1" role="dialog" id="vac-alert" >	  
	<div class="modal-dialog" role="document">
		<div class="modal-content">
			<div class="modal-header">
				<button type="button" class="close" data-dismiss="modal" aria-label="Close"><span aria-hidden="true">&times;</span></button>
				<h4  class="modal-title">提示信息</h4>
			</div>
			<div class="modal-body">
				<p class="modal-message"></p>
			</div>
			<div class="modal-footer">
				<button type="button" class="btn btn-primary" data-dismiss="modal" data-target="#vac-alert">确定</button>
			</div>
		</div>
	</div>
</div>
        </div>
    </div>
    <!--UILinked objectmodal start -->

<script type="text/javascript" src="/public/lib/mod_36ad799.js"></script>
<script>/*resourcemap*/


        document.querySelector('#logout').onclick = function() {
            if(sessionStorage.getItem('userId')) {
                sessionStorage.setItem('userId', '')
                document.location.href = 'Login.html'
            }
        }
    

    var sidebarVue 
    window.addEventListener('load', function(){
        sidebarVue = new Vue({
            el: '#sidebar',
            data: {
                menu: '',
                subMenu: ''
            },
            ready: function(){
                var caselib_Id = sessionStorage.getItem('caselibId')
                if(!caselib_Id) {
                    for(let i = 2; i <= 9; i++) {
                        $('.3-'+i).css({display: 'none'})
                    }
                }
            }
        })
    })


    var Vac = Vac || {};
    Vac.confirm = function(divSelector, okSelector, cancelSelector, confirmString) {
        divSelector = divSelector || '#vac-confirm';
        okSelector = okSelector || '.okConfirm';
        cancelSelector = cancelSelector || '.cancelConfirm';
        var confirmDiv = document.querySelector(divSelector);
        if(confirmString) {
            document.querySelector(divSelector + ' ' + ".modal-message").innerHTML = confirmString;
        }
        // console.log('hakjadkjhakjsd')
        $(divSelector).modal('show');
        return new Promise(function(resolve, reject) {
            confirmDiv.querySelector(okSelector).onclick = function() {
                resolve();
                $(divSelector).modal('hide');
            };
            var cancelButtons = confirmDiv.querySelectorAll(cancelSelector);
            for (var i = 0; i < cancelButtons.length; i++) {
                cancelButtons[i].onclick = function() {
                    reject();
                    $(divSelector).modal('hide');
                }
            }
        });
    }


	var Vac = Vac || {};
	Vac.alert = function(message) {
		$('.vac-alert .modal-message').html(message);
		$('#vac-alert').modal('show');
		return this;
	};
	Vac.removeAlert = function(msec) {
		setTimeout(function() {
			$('#vac-alert').modal('hide');
		}, msec);
	}


	window.addEventListener('load', function(){
		var userId = sessionStorage.getItem('userId')
		if(userId == null || userId == "") {
			window.location.href = 'Login.html'
		}else{
			var userName=sessionStorage.getItem('userName');
			$('#curUserName').text(userName);
		}
	})
</script>
<script src="/public/lib/jquery_9f7c65c.js"></script>
<script src="/public/lib/jquery-1.8.3.min_24bd97b.js"></script>
<script src="/public/lib/bootstrap.min_9e25e8e.js"></script>
<script src="/public/lib/jquery.scrollTo.min_bd938d0.js"></script>
<script type="text/javascript" src="/public/lib/jquery.nicescroll_c984421.js"></script>
<script type="text/javascript" src="/public/lib/jquery.sparkline_f684675.js"></script>
<script src="/public/lib/jquery.easy-pie-chart_3c93cce.js"></script>
<script src="/public/lib/owl.carousel_ecd7bf6.js"></script>
<script src="/public/lib/jquery.customSelect.min_f90c1f4.js"></script>
<script src="/public/lib/approve.min_a71c3d0.js"></script>
<script src="/public/lib/common-scripts_042ab5a.js"></script>
<script type="text/javascript" src="/public/lib/vue_b5d791e.js"></script>
<script type="text/javascript" src="/public/static/js/constant_1179c29.js"></script>
<script type="text/javascript" src="/public/lib/form-component_e441093.js"></script>
<script type="text/javascript" src="/public/static/js/config_b5e705e.js"></script>
<script type="text/javascript" src="/public/lib/jquery.ztree.all.min_b744490.js"></script>
<script>
var app = new Vue({
    el: '#elementLibrary',
    data: function() {
        var _this = this;
        return {
            autId: '',
            transactId: '',
            elementRepositoryId: 6,
            UIName: '',
            UITitle: 'UI',
            eleName: '',
            UILinked: '',
            eleParent: '',
            eleLinked: '',
            mainPropTr: '<tr><td><input type="checkbox" name="mainProp"/></td><td contenteditable="true"></td><td contenteditable="true"></td></tr>',
            addiPropTr: '<tr><td><input type="checkbox" name="addiProp"/></td><td contenteditable="true"></td><td contenteditable="true"></td></tr>',
            assiPropTr: '<tr><td><input type="checkbox" name="assiProp"/></td><td contenteditable="true"></td><td contenteditable="true"></td></tr>',
            linkedPropTr: '<tr><td><input type="checkbox" name="linkProp"/></td><td contenteditable="true"></td><td contenteditable="true"></td></tr>',
            classtypeList: [], //控件类型下拉列表
            mainList: [], //主属性
            mainListLength: 0,
            addiList: [], //附加属性
            addiListLength: 0,
            assiList: [], //辅助属性
            assiListLength: 0,
            relatePropList: [], //关联属性
            relatePropListLength: 0,
            /*elementtree start*/
            setting1: {
                view: {
                    addHoverDom: false,
                    removeHoverDom: false,
                    selectedMulti: true
                },
                check: {
                    enable: false,
                    chkStyle: "checkbox",
                    chkboxType: { "Y": "ps", "N": "ps" }
                },
                data: {
                    simpleData: {
                        enable: false,
                        idKey: 'id', //id编号命名
                        pIdKey: 'parentid', //父id编号命名
                        rootPId: 0
                    }
                },
                edit: {
                    enable: true,
                    showRemoveBtn: false,
                    showRenameBtn: false
                },
                //回调函数
                callback: {
                    // 禁止拖拽
                    beforeDrag: _this.zTreeBeforeDrag,
                    //点击时的回调函数
                    onClick: function(event, treeId, treeNode, clickFlag) {
                        console.log(treeNode)
                        var transid = !_this.componentMode ? _this.transactId : _this.transid;
                        if (treeNode.level == 0) { //选择的是UI
                            $(':input', '#UIForm').val('');
                            _this.getUILinkedObjectTree();
                            _this.UIName = treeNode.name;
                            _this.UITitle = treeNode.name;
                            var uiId=treeNode.id;
                            $('#UIForm input[name="UIName"]').val(treeNode.name);
                            $('#blank').css('display', 'none');
                            $('#UI').css('display', 'block');
                            $('#ele').css('display', 'none');
                            $.ajax({
                                url: address3 + 'elementRepository/querySingleUI',
                                type: 'post',
                                contentType: 'application/json',
                                data: JSON.stringify({
                                    "repositoryId": _this.elementRepositoryId,
                                    "uiId": uiId
                                }),
                                success: function(data) {
                                    var relateObjectId = data.relateIdentifyObjectId;
                                    var treeObj = $.fn.zTree.getZTreeObj("UILinkedTree");
                                    if (relateObjectId !== null && relateObjectId !== undefined && relateObjectId !== '') {
                                        treeObj.selectNode(treeObj.getNodeByParam("objectId", relateObjectId, null));
                                        var nodes = treeObj.getSelectedNodes();
                                        var obj = nodes[0].objectName;
                                        $('#UILinkedInput').val(obj);
                                    }
                                }
                            });
                        } else { //选择的是元素
                            $('#classtypeSelect').val('');
                            $('#eleParentInput').val('');
                            $('#eleLinkedInput').val('');
                            _this.getEleParentObjectTree();
                            _this.getEleLinkedObjectTree();
                            var treeObj = $.fn.zTree.getZTreeObj("elementtree");
                            var nodes = treeObj.getSelectedNodes();
                            _this.eleName = treeNode.name;
                            _this.elementId=treeNode.id;
                            var parentNode = nodes[0].getParentNode();
                            _this.UIName = parentNode.name;
                            var uiId=parentNode.id;
                            $("#mainTbody").children().remove();
                            $("#addiTbody").children().remove();
                            $("#assiTbody").children().remove();
                            $("#relatePropTbody").children().remove();
                            $('#blank').css('display', 'none');
                            $('#UI').css('display', 'none');
                            $('#ele').css('display', 'block');
                            var transid = !_this.componentMode ? _this.transactId : _this.transid;
                            $.ajax({
                                url: address3 + 'elementRepository/querySingleElement',
                                type: 'post',
                                contentType: 'application/json',
                                data: JSON.stringify({
                                    'repositoryId': _this.elementRepositoryId,
                                    "uiId": uiId,
                                    "elementId": _this.elementId 
                                }),
                                success: function(data) {
                                    console.log(data);
                                    var classtype = data.element.classType;
                                    $('#classtypeSelect').val(classtype);
                                    var relateParentObjectId = data.element.relateParentIdentifyObjectId;
                                    var relateObjectId = data.element.relateIdentifyObjectId;
                                    if (relateParentObjectId !== null && relateParentObjectId !== undefined && relateParentObjectId !== '') {
                                        //父对象
                                        var elePtree = $.fn.zTree.getZTreeObj("eleParentTree");
                                        elePtree.selectNode(elePtree.getNodeByParam("objectId", relateParentObjectId, null));
                                        var pNodes = elePtree.getSelectedNodes(),
                                            pObj = pNodes[0].objectName;
                                        $('#eleParentInput').val(pObj);
                                    }
                                    if (relateObjectId !== null && relateObjectId !== undefined && relateObjectId !== '') {
                                        //关联对象
                                        var eleLtree = $.fn.zTree.getZTreeObj("eleLinkedTree");
                                        eleLtree.selectNode(eleLtree.getNodeByParam("objectId", relateObjectId, null));
                                        var lNodes = eleLtree.getSelectedNodes(),
                                            lObj = lNodes[0].objectName;
                                        $('#eleLinkedInput').val(lObj);
                                    }

                                    //主属性
                                    _this.mainList = [];
                                    _this.mainList = data.element.mainProperties;
                                    _this.mainListLength = _this.mainList.length;
                                    for (let i = 0; i < _this.mainListLength; i++) {
                                        let paraTr = $('<tr></tr>'),
                                            paraCheckTd = $('<td><input type="checkbox" name="mainProp"/></td>'),
                                            paraNameTd = $('<td contenteditable="true"></td>'),
                                            paraValTd = $('<td contenteditable="true"></td>');
                                        paraNameTd.html(_this.mainList[i].name);
                                        paraValTd.html(_this.mainList[i].value);
                                        paraTr.append(paraCheckTd, paraNameTd, paraValTd);
                                        $('#mainTbody').append(paraTr);
                                    }

                                    //附加属性
                                    _this.addiList = data.element.additionalProperties;
                                    _this.addiListLength = _this.addiList.length;
                                    for (let i = 0; i < _this.addiListLength; i++) {
                                        let paraTr = $('<tr></tr>'),
                                            paraCheckTd = $('<td><input type="checkbox" name="addiProp"/></td>'),
                                            paraNameTd = $('<td contenteditable="true"></td>'),
                                            paraValTd = $('<td contenteditable="true"></td>');
                                        paraNameTd.html(_this.addiList[i].name);
                                        paraValTd.html(_this.addiList[i].value);
                                        paraTr.append(paraCheckTd, paraNameTd, paraValTd);
                                        $('#addiTbody').append(paraTr);
                                    }

                                    //辅助属性
                                    _this.assiList = data.element.assistantProperties;
                                    _this.assiListLength = _this.assiList.length;
                                    for (var i = 0; i < _this.assiListLength; i++) {
                                        var paraTr = $('<tr></tr>'),
                                            paraCheckTd = $('<td><input type="checkbox" name="assiProp"/></td>'),
                                            paraNameTd = $('<td contenteditable="true"></td>'),
                                            paraValTd = $('<td contenteditable="true"></td>');
                                        paraNameTd.html(_this.assiList[i].name);
                                        paraValTd.html(_this.assiList[i].value);
                                        paraTr.append(paraCheckTd, paraNameTd, paraValTd);
                                        $('#assiTbody').append(paraTr);
                                    }
                                    //关联属性
                                    _this.assiList = data.element.relateProperties;
                                    _this.assiListLength = _this.assiList.length;
                                    for (var i = 0; i < _this.assiListLength; i++) {
                                        var paraTr = $('<tr></tr>'),
                                            paraCheckTd = $('<td><input type="checkbox" name="assiProp"/></td>'),
                                            paraNameTd = $('<td contenteditable="true"></td>'),
                                            paraValTd = $('<td contenteditable="true"></td>');
                                        paraNameTd.html(_this.assiList[i].name);
                                        paraValTd.html(_this.assiList[i].value);
                                        paraTr.append(paraCheckTd, paraNameTd, paraValTd);
                                        $('#relatePropTbody').append(paraTr);
                                    }

                                }
                            });
                        }
                    },

                }
            },
            /*UILinked objecttree start*/
            setting2: {
                view: {
                    addHoverDom: false,
                    removeHoverDom: false,
                    selectedMulti: false
                },
                check: {
                    enable: false,
                    chkStyle: "checkbox",
                    chkboxType: { "Y": "s", "N": "ps" }
                },
                data: {
                    simpleData: {
                        enable: true,
                        idKey: 'objectId', //id编号命名
                        pIdKey: 'parentObjectId', //父id编号命名
                        rootPId: 0
                    },
                    key: {
                        name: "objectName"
                    }
                },
                edit: {
                    enable: true,
                    showRemoveBtn: false,
                    showRenameBtn: false
                },

                //回调函数
                callback: {
                    // 禁止拖拽
                    beforeDrag: _this.zTreeBeforeDrag,
                    onClick: function(event, treeId, treeNode, clickFlag) {
                        // console.log(treeNode)
                        _this.UILinked = treeNode.objectName;
                    },

                }
            },

        }
    },
    ready: function() {
        this.getAutandTrans();
        var _this = this;
        $('#autSelect').change(function() {
            _this.transactSelect();
            _this.autId = $('#autSelect').val();
            _this.transactId = $('#transactSelect').val();
            _this.getElementTree();
            _this.classtypeSelect();
        });
        $('#transactSelect').change(function() {
            _this.transactId = $('#transactSelect').val();
            _this.getElementTree();
        });
        $('.2').addClass('open');
        $('.2 .arrow').addClass('open');
        $('.2-ul').css({ display: 'block' });
        $('.2-0').css({ color: '#ff6c60' });
    },
    methods: {
        //初始化获取测试系统和功能点
        getAutandTrans: function() {
            var _this = this;
            $.ajax({
                url: address3 + "aut/queryListAut",
                type: "POST",
                contentType:'application/json',
                success: function(data) {
                    var autList = data.autRespDTOList;
                    var str = "";
                    for (var i = 0; i < autList.length; i++) {

                        str += " <option value='" + autList[i].id + "' >" + autList[i].nameMedium + "</option> ";
                    }

                    $('#autSelect').html(str);
                    _this.autId = sessionStorage.getItem("autId");
                    $("#autSelect").val(_this.autId);
                    $.ajax({
                        url: address3 + 'transactController/pagedBatchQueryTransact',
                        type: 'POST',
                        contentType: 'application/json',
                        data: JSON.stringify({
                            'currentPage': 1,
                            'pageSize': 100000,
                            'orderColumns': 'id',
                            'orderType': 'asc',
                            'autId': _this.autId
                        }),
                        success: function(data) {
                            var transactList = data.list;
                            var str = "";
                            for (var i = 0; i < transactList.length; i++) {

                                str += " <option value='" + transactList[i].id + "'>" + transactList[i].nameMedium + "</option> ";
                            }
                            $('#transactSelect').html(str);
                            _this.transactId = sessionStorage.getItem("transactId");
                            $("#transactSelect").val(_this.transactId);
                            // 获取ui和element
                            $.ajax({
                                url: address3 + 'elementRepository/queryAllElementsForATransact',
                                type: 'post',
                                contentType: 'application/json',
                                data: JSON.stringify({ "transactId": _this.transactId }),
                                success: function(data) {
                                    console.log(data)
                                    if (data !== null) {
                                        var nodes=[];
                                        var uis=data.uis;
                                        for(var i=0; i<uis.length; i++){
                                            var uiNode={};
                                            uiNode.id=uis[i].uiId;
                                            uiNode.name=uis[i].uiName;       
                                            let elements=uis[i].elements;
                                            if(elements){
                                                uiNode.children=[];
                                                for(var j=0; j<elements.length; j++){
                                                    var eleNode={};
                                                    eleNode.id=elements[j].elementId;
                                                    eleNode.name=elements[j].elementName;
                                                    uiNode.children.push(eleNode);
                                                }
                                            }
                                            nodes.push(uiNode);
                                        }
                                        // console.log(nodes)
                                        $.fn.zTree.init($("#elementtree"), _this.setting1, nodes);
                                        app.elementRepositoryId = data.elementRepositoryId;
                                    }
                                }
                            });
                            // 获取classtype
                             $.ajax({
                                url: address3 + 'aut/queryAutVisibleOmClasses',
                                contentType: 'application/json',
                                data: JSON.stringify({ 'id': _this.autId }),
                                type: "POST",
                                success: function(data) {
                                    // console.log(data)
                                    _this.classtypeList = data.omClassRespDTOList.concat(data.arcClassRespDTOList);
                                }
                            });
                            _this.getUILinkedObjectTree();
                            _this.getEleParentObjectTree();
                            _this.getEleLinkedObjectTree();
                        }

                    });
                }
            });
        },
        //获取测试系统
        autSelect: function() {
            $.ajax({
                async: false,
                url: address3 + "aut/queryListAut",
                type: "POST",
                contentType:'application/json',
                success: function(data) {
                    var autList = data.autRespDTOList;
                    var str = "";
                    for (var i = 0; i < autList.length; i++) {

                        str += " <option value='" + autList[i].id + "' >" + autList[i].nameMedium + "</option> ";
                    }

                    $('#autSelect').html(str);

                }
            });
        },
        //功能点
        transactSelect: function() {
            var val = $('#autSelect').val();
            $.ajax({
                async: false,
                url: address3 + 'transactController/pagedBatchQueryTransact',
                type: 'POST',
                contentType: 'application/json',
                data: JSON.stringify({
                    'currentPage': 1,
                    'pageSize': 100000,
                    'orderColumns': 'id',
                    'orderType': 'asc',
                    'autId': val,
                }),
                success: function(data) {
                    var transactList = data.list;
                    var str = "";
                    for (var i = 0; i < transactList.length; i++) {

                        str += " <option value='" + transactList[i].id + "'>" + transactList[i].nameMedium + "</option> ";
                    }
                    $('#transactSelect').html(str);
                }

            });
        },
        //获取classtype
        classtypeSelect: function() {
            // var val = $('#autSelect').val();
            var _this = this;
            $.ajax({
                url: address3 + 'aut/queryAutVisibleOmClasses',
                contentType: 'application/json',
                data: JSON.stringify({ 'id': _this.autId }),
                type: "POST",
                success: function(data) {
                    // console.log(data)
                    _this.classtypeList = data.omClassRespDTOList.concat(data.arcClassRespDTOList);
                }
            });
        },
        //设置所属测试系统和所属功能点为上级页面选中的值
        setval: function() {
            this.autId = sessionStorage.getItem("autId");
            this.transactId = sessionStorage.getItem("transactId");
            $("#autSelect").val(this.autId);
            $("#transactSelect").val(this.transactId);
        },
        addUI: function() {
            var _this = this;
            var transid = !this.componentMode ? this.transactId : this.transid;
            var UIName = $("#addUIName").val(),
                relateIdentifyObjectId = $("#addRelateIdentifyObjectId").val(),
                relateParentIdentifyObjectId = $("#addRelateParentIdentifyObjectId").val();
            if(UIName==''){
                alert('UI名称不能为空');
            }else{
                var uiNames;
                var uis=[];
                if(UIName.indexOf(',')>0){//批量
                    uiNames=UIName.split(",");
                    for(var i=0; i<uiNames.length; i++){
                        let ui={};
                        ui.uiName=uiNames[i];
                        uis.push(ui);
                    }
                }else{//单个
                    let ui={};
                    ui.uiName=UIName;
                    uis.push(ui);
                }
                $.ajax({
                    url: address3 + 'elementRepository/batchAddUI',
                    type: 'post',
                    contentType: 'application/json',
                    data: JSON.stringify({
                        'repositoryId': _this.elementRepositoryId,
                        'uis': uis
                    }),
                    success: function(data) {
                        if (data.respCode==0000) {
                            $('#successModalEle').modal('show');
                            _this.getElementTree();
                            $("#addUIName").val('');
                        } else {
                            $('#failModalEle').modal('show');
                            $("#addUIName").val('');
                        }
                    },
                    error: function() {
                        $('#failModalEle').modal('show');
                        $("#addUIName").val('');
                    }
                });
            }
        },
        delUI: function() {
            var _this = this;
            var treeObj = $.fn.zTree.getZTreeObj("elementtree");
            var nodes = treeObj.getSelectedNodes();
            var id = nodes[0].id;
            $.ajax({
                url: address3 + 'elementRepository/deleteSingleUI',
                type: 'post',
                contentType: 'application/json',
                data: JSON.stringify({
                    "uiId": id,
                    "repositoryId": _this.elementRepositoryId
                }),
                success: function(data) {
                    if (data.respCode==0000) {
                        $('#successModalEle').modal();
                        _this.getElementTree();
                    } else {
                        $('#failModalEle').modal();
                    }
                },
                error: function() {
                    $('#failModalEle').modal();
                }
            });
        },
        updateUI: function() {
            var _this = this;
            var treeObj = $.fn.zTree.getZTreeObj("elementtree"),
                nodes = treeObj.getSelectedNodes(),
                uiId = nodes[0].id,
                RUIName = $('#RUIName').val(),
                LtreeObj = $.fn.zTree.getZTreeObj("UILinkedTree");
            var Lnodes,
                relateIdentifyObjectId,
                relateParentIdentifyObjectId;
            if (LtreeObj) {
                Lnodes = LtreeObj.getSelectedNodes();
                if (Lnodes.length !== 0) {
                    relateIdentifyObjectId = Lnodes[0].objectId;
                    relateParentIdentifyObjectId = Lnodes[0].parentObjectId;
                } else {
                    relateIdentifyObjectId = '';
                    relateParentIdentifyObjectId = '';
                }

            } else {
                relateIdentifyObjectId = '';
                relateParentIdentifyObjectId = '';
            }
            $.ajax({
                url: address3 + 'elementRepository/modifySingleUI',
                type: 'post',
                contentType: 'application/json',
                data: JSON.stringify({
                    'repositoryId': _this.elementRepositoryId,
                    "uiId": uiId,
                    "relateIdentifyObjectId": relateIdentifyObjectId
                }),
                success: function(data) {
                    // console.info(data);
                    if (data.respCode==0000) {
                        $('#successModalEle').modal();
                        _this.getElementTree();
                        $('#blank').css('display', 'block');
                        $('#UI').css('display', 'none');
                        $('#ele').css('display', 'none');
                    } else {
                        $('#failModalEle').modal();
                    }
                },
                error: function() {
                    $('#failModalEle').modal();
                    $('#blank').css('display', 'block');
                    $('#UI').css('display', 'none');
                    $('#ele').css('display', 'none');
                }
            });
        },
        checkAddElement(){
            let treeObj = $.fn.zTree.getZTreeObj("elementtree"),
                nodes = treeObj.getSelectedNodes();
            if(nodes.length==0){
                $('#elementAlertModal').modal();
            }else{
                $('#addElementModal').modal();
            }
        },
        addElement: function() {
            var _this = this;
            var transid = !this.componentMode ? _this.transactId : _this.transid;
            var ElementName = $("#addElementName").val(),
                ClassType = $("#classtypeSelect").val(),
                relateIdentifyObjectId = $("#addEleRelateIdentifyObjectId").val(),
                relateParentIdentifyObjectId = $("#addEleRelateParentIdentifyObjectId").val(),
                treeObj = $.fn.zTree.getZTreeObj("elementtree"),
                nodes = treeObj.getSelectedNodes(),
                selectedUIName = nodes[0].name,
                uiId=nodes[0].id;
            if(ElementName==''){
                alert('元素名称不能为空');
            }else{
                var elementNames;
                var elements=[];
                if(ElementName.indexOf(",")>0){//批量
                    elementNames=ElementName.split(",");
                    for(var i=0; i<elementNames.length; i++){
                        let element={};
                        element.elementName=elementNames[i];
                        elements.push(element);
                    }
                }else{//单个
                    let element={};
                    element.elementName=ElementName;
                    elements.push(element);
                }
                $.ajax({
                    url: address3 + 'elementRepository/batchAddOrModifyElement',
                    type: 'post',
                    contentType: 'application/json',
                    data: JSON.stringify({
                        'repositoryId': _this.elementRepositoryId,
                        "uiId": uiId,
                        "elements": elements
                    }),
                    success: function(data) {
                        // console.info(data);
                        if (data.respCode==0000) {
                            $('#successModalEle').modal();
                            _this.getElementTree();
                            var treeObj = $.fn.zTree.getZTreeObj("elementtree");
                            var pNode=treeObj.getNodeByParam('name', selectedUIName, null);
                            treeObj.expandNode(pNode);
                        } else {
                            $('#failModalEle').modal();
                        }
                    },
                    error: function() {
                        $('#failModalEle').modal();
                    }
                });
            }
        },
        delElement: function() {
            var _this = this;
            var treeObj = $.fn.zTree.getZTreeObj("elementtree");
            var nodes = treeObj.getSelectedNodes();
            var elementId = nodes[0].id;
            var uiId = nodes[0].getParentNode().id;
            $.ajax({
                url: address3 + 'elementRepository/deleteSingleElement',
                type: 'post',
                contentType: 'application/json',
                data: JSON.stringify({
                    'repositoryId': _this.elementRepositoryId,
                    "elementId": elementId,
                    "uiId": uiId
                }),
                success: function(data) {
                    console.info(data);
                    if (data.respCode==0000) {
                        $('#successModalEle').modal();
                        _this.getElementTree();
                    } else {
                        $('#failModalEle').modal();
                    }
                },
                error: function() {
                    $('#failModalEle').modal();
                }
            });
        },
        updateElement: function() {
            var _this = this;
            var transid = !this.componentMode ? this.transactId : this.transid;
            var treeObj = $.fn.zTree.getZTreeObj("elementtree"),
                nodes = treeObj.getSelectedNodes();
            if(nodes.length==0){
                alert('请先选中元素');
            }else{
                var uiId = nodes[0].getParentNode().id,
                    eleName = nodes[0].name,
                    elementId=nodes[0].id;
            }
            var rEleName = $('#rEleName').val(),
                LtreeObj = $.fn.zTree.getZTreeObj("eleLinkedTree");
            var Lnodes, relateIdentifyObjectId;
            if (LtreeObj) {
                Lnodes = LtreeObj.getSelectedNodes();
                if (Lnodes.length !== 0) {
                    relateIdentifyObjectId = Lnodes[0].objectId;
                } else {
                    relateIdentifyObjectId = '';
                }
            } else {
                relateIdentifyObjectId = '';
            }
            var PtreeObj = $.fn.zTree.getZTreeObj("eleParentTree");
            var Pnodes, relateParentIdentifyObjectId;
            if (PtreeObj) {
                Pnodes = PtreeObj.getSelectedNodes();
                if (Pnodes.length !== 0) {
                    relateParentIdentifyObjectId = Pnodes[0].objectId;
                } else {
                    relateParentIdentifyObjectId = '';
                }

            } else {
                relateParentIdentifyObjectId = '';
            }
            // 2017-10-24 classType改为发送名字
            // 控件类型
            var ClassType = $('#classtypeSelect').val();
            //主属性
            var mainTd,
                mainProperties=[],
                mainItem={};
            $('#mainTbody').find('tr').each(function() {
                mainTd = $(this).children();
                mainItem.name=mainTd.eq(1).html();
                mainItem.value=mainTd.eq(2).html();
                mainItem.method='';
                mainItem.isRelative=null;
                mainItem.toolName='';
                mainProperties.push(mainItem);
            });
            //附加属性
            var addiTd,
                additionalProperties=[],
                addiItem={};
            $('#addiTbody').find('tr').each(function() {
                addiTd = $(this).children();
                addiItem.name=addiTd.eq(1).html();
                addiItem.value=addiTd.eq(2).html();
                addiItem.method='';
                addiItem.isRelative=null;
                addiItem.toolName='';
                additionalProperties.push(addiItem);
            });
            //辅助属性
            var assiTd,
                assitantProperties=[],
                assiItem={};
            $('#assiTbody').find('tr').each(function() {
                assiTd = $(this).children();
                assiItem.name=assiTd.eq(1).html();
                assiItem.value=assiTd.eq(2).html();
                assiItem.method='';
                assiItem.isRelative=null;
                assiItem.toolName='';
                assitantProperties.push(assiItem);
            });
            //关联属性 
            var relTd,
                relateProperties=[],
                relItem={};
            $('#relatePropTbody').find('tr').each(function() {
                relTd = $(this).children();
                relItem.name=relTd.eq(1).html();
                relItem.value=relTd.eq(2).html();
                relItem.method='';
                relItem.isRelative=null;
                relItem.toolName='';
                relateProperties.push(relItem);
            });
            $.ajax({
                url: address3 + 'elementRepository/modifySingleElement',
                type: 'post',
                contentType: 'application/json',
                data: JSON.stringify({
                    'repositoryId': _this.elementRepositoryId,
                    "uiId": uiId,
                    "element": {
                        "elementId": elementId,
                        "elementName": eleName,
                        "classType": ClassType,
                        "relateIdentifyObjectId": relateIdentifyObjectId,
                        "relateParentIdentifyObjectId": relateParentIdentifyObjectId,
                        "mainProperties": mainProperties,
                        "additionalProperties": additionalProperties,
                        "assitantProperties": assitantProperties,
                        "relateProperties": relateProperties
                    }
                }),
                success: function(data) {
                    // console.log(data);
                    if (data.respCode==0000) {
                        $('#successModalEle').modal();
                        _this.getElementTree();
                        // treeObj.selectNode(nodes[0]);
                        $('#blank').css('display', 'block');
                        $('#UI').css('display', 'none');
                        $('#ele').css('display', 'none');
                    } else {
                        $('#failModalEle').modal();
                    }
                },
                error: function() {
                    $('#failModalEle').modal();
                    $('#blank').css('display', 'block');
                    $('#UI').css('display', 'none');
                    $('#ele').css('display', 'none');
                }
            });
        },
        // 添加主属性
        addMainProp: function() {
            var curTbody = $('#mainTbody');
            curTbody.append(this.mainPropTr);
        },
        // 删除主属性
        delMainProp: function() {
            var selectedTr = $('#mainTbody').find('input[name="mainProp"]:checked').parent().parent();
            selectedTr.remove();
        },
        // 添加附加属性
        addAddiProp: function() {
            var curTbody = $('#addiTbody');
            curTbody.append(this.addiPropTr);
        },
        // 删除附加属性
        delAddiProp: function() {
            var selectedTr = $('#addiTbody').find('input[name="addiProp"]:checked').parent().parent();
            selectedTr.remove();
        },
        // 添加辅助属性
        addAssiProp: function() {
            var curTbody = $('#assiTbody');
            curTbody.append(this.assiPropTr);
        },
        // 删除辅助属性
        delAssiProp: function() {
            var selectedTr = $('#assiTbody').find('input[name="assiProp"]:checked').parent().parent();
            selectedTr.remove();
        },
        //添加关联元素属性
        addLinkedProp: function() {
            var curTbody = $('#relatePropTbody');
            curTbody.append(this.linkedPropTr);
        },
        // 删除关联元素属性
        delLinkedProp: function() {
            var selectedTr = $('#relatePropTbody').find('input[name="linkProp"]:checked').parent().parent();
            selectedTr.remove();
        },

        // 页面初始化获取元素库
        getElementTree: function() {
            var _this = this;
            var transid = !this.componentMode ? $("#transactSelect").val() : this.transid;
            $.ajax({
                url: address3 + 'elementRepository/queryAllElementsForATransact',
                type: 'post',
                contentType: 'application/json',
                data: JSON.stringify({ "transactId": transid }),
                success: function(data) {
                    if (data !== null) {
                        var nodes = [];
                        var uis = data.uis;
                        for (var i = 0; i < uis.length; i++) {
                            var uiNode = {};
                            uiNode.id = uis[i].uiId; 
                            uiNode.name = uis[i].uiName;                          
                            let elements = uis[i].elements;
                            if (elements) {
                                uiNode.children = [];
                                for (var j = 0; j < elements.length; j++) {
                                    var eleNode = {};
                                    eleNode.id=elements[j].elementId;
                                    eleNode.name = elements[j].elementName;
                                    uiNode.children.push(eleNode);
                                }
                            }
                            nodes.push(uiNode);
                        }
                        $.fn.zTree.init($("#elementtree"), _this.setting1, nodes);
                        app.elementRepositoryId = data.elementRepositoryId;
                    }
                }
            });
        },
        //禁止拖动
        zTreeBeforeDrag: function(treeId, treeNodes) {
            return false;
        },
        //用按钮查询节点  
        searchNodes: function() {
            var treeObj = $.fn.zTree.getZTreeObj("elementtree");
            var keywords = $("#keyword").val();
            var nodes = treeObj.getNodesByParamFuzzy("name", keywords, null);
            if (nodes.length > 0) {
                treeObj.selectNode(nodes[0]);
            }
        },
        /*elementtree end*/
        // 页面初始化获取对象库
        getUILinkedObjectTree: function() {
            var _this = this;
            // var transid = $("#transactSelect").val();
            var transid = !this.componentMode ? $("#transactSelect").val() : this.transid;
            $.ajax({
                url: address3 + 'objectRepository/queryAllObjectForATransact',
                type: 'post',
                contentType: 'application/json',
                data: JSON.stringify({ "transactId": transid }),
                success: function(data) {
                    if (data !== null) {
                        $.fn.zTree.init($("#UILinkedTree"), _this.setting2, data.objects);
                    }
                }
            });
        },
        //UI关联对象库中对象
        setUILinked: function() {
            var treeObj = $.fn.zTree.getZTreeObj("UILinkedTree"),
                nodes = treeObj.getSelectedNodes(),
                obj = nodes[0].objectName;
            if (nodes[0].getParentNode()) {
                var pObj = nodes[0].getParentNode().objectName;
                $('#UILinkedInput').val(pObj + ' / ' + obj);
            } else {
                $('#UILinkedInput').val(obj);
            }
        },
        //解除关联
        removeUILinked: function() {
            var treeObj = $.fn.zTree.getZTreeObj("UILinkedTree");
            treeObj.cancelSelectedNode();
            $('#UILinkedInput').val('');
            // $('#successModalEle').modal();
        },
        /*UILinked objecttree end*/
        // 页面初始化获取对象库
        getEleParentObjectTree: function() {
            var _this = this;
            var transid = !this.componentMode ? $("#transactSelect").val() : this.transid;
            $.ajax({
                url: address3 + 'objectRepository/queryAllObjectForATransact',
                type: 'post',
                contentType: 'application/json',
                data: JSON.stringify({ "transactId": transid }),
                success: function(data) {
                    if (data !== null) {
                        $.fn.zTree.init($("#eleParentTree"), _this.setting2, data.objects);
                    }
                }
            });
        },
        //设置对象库中父对象
        setEleParent: function() {
            var treeObj = $.fn.zTree.getZTreeObj("eleParentTree"),
                nodes = treeObj.getSelectedNodes(),
                obj = nodes[0].objectName;
            if (nodes[0].getParentNode()) {
                var pObj = nodes[0].getParentNode().objectName;
                $('#eleParentInput').val(pObj + ' / ' + obj);
            } else {
                $('#eleParentInput').val(obj);
            }
        },
        // 解除关联对象库中父对象
        removeEleParent: function() {
            var treeObj = $.fn.zTree.getZTreeObj("eleParentTree");
            treeObj.cancelSelectedNode();
            $('#eleParentInput').val('');
            // $('#successModalEle').modal();
        },
        /*eleParent objecttree end*/
        // 页面初始化获取对象库
        getEleLinkedObjectTree: function() {
            var _this = this;
            var transid = !this.componentMode ? $("#transactSelect").val() : this.transid;
            $.ajax({
                url: address3 + 'objectRepository/queryAllObjectForATransact',
                type: 'post',
                contentType: 'application/json',
                data: JSON.stringify({ "transactId": transid }),
                success: function(data) {
                    if (data !== null) {
                        $.fn.zTree.init($("#eleLinkedTree"), _this.setting2, data.objects);
                    }
                }
            });
        },
        //设置对象库中关联对象
        setEleLinked: function() {
            var treeObj = $.fn.zTree.getZTreeObj("eleLinkedTree"),
                nodes = treeObj.getSelectedNodes(),
                obj = nodes[0].objectName;
            if (nodes[0].getParentNode()) {
                var pObj = nodes[0].getParentNode().objectName;
                $('#eleLinkedInput').val(pObj + ' / ' + obj);
            } else {
                $('#eleLinkedInput').val(obj);
            }
        },
        // 解除对象库中关联对象
        removeEleLinked: function() {
            var treeObj = $.fn.zTree.getZTreeObj("eleLinkedTree");
            treeObj.cancelSelectedNode();
            $('#eleLinkedInput').val('');
            // $('#successModalEle').modal();
        },
        /*eleLinked objecttree end*/

        //勾选关联元素名称
        relateNameClick: function(event) {
            if ($(event.target).attr('checked')) {}
        },
        // 跳转到对象库页面配置上级页面选中的功能点的对象库
        toObjectRepo: function() {
            location.href = "objectRepo.html";
        },
        // 跳转到基础脚本页面配置上级页面选中的功能点的基础脚本
        toScript: function() {
            location.href = "script.html";
        },
    }
});
</script>
</body>

</html>
<!--common script for all pages-->
<!--script for this page only-->
<!-- <script type="text/javascript" src="../static/js/elementLibrary.js"></script> -->
<!-- ztree -->